# Клиент-Серверное приложение, отображающее древовидную структуру.


![demo image](https://image.ibb.co/iLuqkF/tree_demo.gif)


## Функциональность

* возможность добавления/переименования/удаления узлов;
* выделенный элемент отмечен бирюзовым цветом;
* реализована "ленивая" загрузка узлов дерева, с задержкой в 2 секунды, во время которой появляется preloader; при этом возможна навигация по дереву;
* хранение данных в БД;
* перенос узла дерева (используется Drag and Drop);

Серверная часть приложение реализована с использованием фреймворка Spring. Данные об узлах хранятся в БД (PostgreSQL) в виде списка смежности - (родитель, дочерний элемент, наименование дочернего элемента). Для описания БД используется liquibase.
При удалении записи, узел (в основной БД) помечается как не имеющий родителя и заносится в таблицу на удаление в будущем. Это нам позволяет быстро выдавать ответ пользователю, не дожидаясь пока пройдет удаление элемента и всех его дочерних. "Ленивое удаление". Очистка удаленных элементов происходит периодически отдельным сервисом.

Клиентская часть реализована с использованием HTML5, JS, JQuery и Bootstrap.



**Примечание.** На данный момент правильность работы приложения расчитана только на одного пользователя. Если успею к сроку сдачи, то реализую учитывающее одновременное изменение древовидной структуры несколькими пользователями.


## Вариант многопользовательский.

![multi image](http://image.ibb.co/hsNMVF/one_Tree_Three_Browsers.gif)


Добавлена возможность одновременного безопасного изменения дерева несколькими пользователями.

Периодически, раз в 2 секунды, с клиента отправляется на сервер список отображаемых узлов, сервер проверят есть ли изменения в них и обратно направляет список измененных узлов, тип изменения и время данного изменения. Клиент проходит по этому списку и вносит изменения если таковые еще не были применены. Всего у нас 4 операции ```ADD, RENAME, DELETE, MOVE```.
При проведение операции над узлами сервер помнит об этом фиксированное время (ГАРАНТ) и на это время блокируется работа с данными узлами. По истечении ГАРАНТА информация об изменении узла удаляется и снимается блокировка с этого узла. За ГАРАНТ все клиенты гарантированно должны получить свежие данные и построить у себя актуальное дерево.

Также, учтена стиуация, когда у пользователя пропадает соединение на время большее чем ГАРАНТ. Тогда его вариант дерева будет отличаться от серверной. Мы запрещаем ему все операции с деревом и предлагаем обновить страницу и получить актуальные данные.
При загрузке основной страницы каждому пользователю отправляется уникальный номер. Сервер отслеживает активность клиентов. Если он втечение определенного времени не запрашивал информацию об изменениях, то его sessionId удаляется. Клиенту предлагается перезагрузить страницу и получить новый sessionID.
